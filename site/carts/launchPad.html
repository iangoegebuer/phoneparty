<!-- html elements can go up here -->
<script>
// remove an existing onbeforeunload handler, so no message is shown
window.onbeforeunload = function () {};

GAMES_LIST = [
  {path:'site/carts/launchPad.html',name:'Launch Pad'},
  {path:'site/carts/lettersAndLists.html', name:'Letters and Lists'},
  {path:'site/carts/lettersAndLists_phonemode.html', name:'Letters and Lists - Phone Mode'},
  //{path:'https://cdn.jsdelivr.net/gh/ChrisLHall/PhonePartyCarts/lettersAndLists.js', name:"GitHub letters and lists"},
]


function Game(gameRoom) {
  console.log(gameRoom);

  gameBase.call(this,gameRoom);

  this.setHandler('chat',function(from, msg) {
    this.messages.append($('<li>').text(msg));
  });
  /*
  this.setHandler('set playerID',function(id) {
  console.log(id);
  $('#nameheader').text('Name: ' + this.gameRoom.name + ' (playerID: ' + this.gameRoom.playerID + ')');
});
*/

console.log($('form'));



$('form').submit(function(){

  this.gameRoom.sendToEveryone("chat", gameRoom.name + ": " + $('#m').val());

  $('#m').val('');
  return false;
});

this.setup = function() {

  this.form = $('<form>').prop({action:"javascript:void(0);"});
  this.messageBox = $('<input>').prop({id:'m',autocomplete:"off",class:"form-control"});
  this.messages = $('<ul>').prop({id:"messages"});
  $('#game').append(this.messages);
  //this.form.append(this.messages);
  this.form.append($('<div>').prop({class:"form-group"}).append(
    $('<div>').prop({class:"input-group mb-3"}).append(this.messageBox).append(
      $('<div>').prop({class:"input-group-append"}).append(
        $('<button>').prop({class:"btn btn-primary",type:"button"}).text('Send'))
      )));

      $('#footer').empty();
      $('#footer').append($('<div>').prop({class:"flex-row w-100"}).append(this.form));


      thisGame = this;


      if(this.isHost) {

        startButton = $('<button>').prop({type:"button",class:"btn btn-secondary"}).text("Start");
        selectGroup = $('<select>').prop({class:"custom-select",id:"gameSelect"});
        selectGroup.append($('<option>').prop({selected:''}).text("Choose game..."));
        GAMES_LIST.forEach(function(element) {
          selectGroup.append($('<option>').prop({value:element.path}).text(element.name));
        });

        this.selectGroup = selectGroup;

        $('#footer').append(
          $('<div>').prop({class:"flex-row"}).append(
            $('<div>').prop({class:"input-group"}).append(this.selectGroup).append(
              $('<div>').prop({class:'input-group-append'}).append(startButton)
            ))
          );

          startButton.click(function() {
            console.log(thisGame.selectGroup.val());
            thisGame.gameRoom.setScript(thisGame.selectGroup.val());
          });

        }

        this.form.submit(function(){

          thisGame.gameRoom.sendToEveryone('chat', thisGame.gameRoom.name +
          ": " + thisGame.messageBox.val());

          thisGame.messageBox.val('');
          return false;
        });

        $('#header').empty();
        $('#header').text(this.gameRoom.name);

        this.started = true;
      }

    }
</script>